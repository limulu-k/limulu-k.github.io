<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>25.01.21 TCP Hijacking in NAT-Enabled Wi-Fi Networks</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	padding-inline-start: 0;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.page-description {
	margin-bottom: 2em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI Variable Display", "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-default_background {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray_background {
	background: rgba(248, 248, 247, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(248, 243, 252, 1);
}
.highlight-pink_background {
	background: rgba(252, 241, 246, 1);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-default_background {
	color: inherit;
	fill: inherit;
}
.block-color-gray_background {
	background: rgba(248, 248, 247, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(248, 243, 252, 1);
}
.block-color-pink_background {
	background: rgba(252, 241, 246, 1);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-uiBlue { background-color: undefined; }
.select-value-color-pink { background-color: rgba(225, 136, 179, 0.27); }
.select-value-color-purple { background-color: rgba(168, 129, 197, 0.27); }
.select-value-color-green { background-color: rgba(123, 183, 129, 0.27); }
.select-value-color-gray { background-color: rgba(84, 72, 49, 0.15); }
.select-value-color-transparentGray { background-color: undefined; }
.select-value-color-translucentGray { background-color: undefined; }
.select-value-color-orange { background-color: rgba(224, 124, 57, 0.27); }
.select-value-color-brown { background-color: rgba(210, 162, 141, 0.35); }
.select-value-color-red { background-color: rgba(244, 171, 159, 0.4); }
.select-value-color-yellow { background-color: rgba(236, 191, 66, 0.39); }
.select-value-color-blue { background-color: rgba(93, 165, 206, 0.27); }
.select-value-color-pageGlass { background-color: undefined; }
.select-value-color-washGlass { background-color: undefined; }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="17fe8cfa-c68c-80f0-a8e8-eb7efcff4f57" class="page sans"><header><h1 class="page-title">25.01.21 TCP Hijacking in NAT-Enabled Wi-Fi Networks</h1><p class="page-description"></p></header><div class="page-body"><h1 id="181e8cfa-c68c-8021-9995-c63db16ca823" class="">요약</h1><ul id="181e8cfa-c68c-8084-b882-e1227b81836b" class="bulleted-list"><li style="list-style-type:disc"><strong>개요</strong><ul id="181e8cfa-c68c-8002-8a7d-dab46123b028" class="bulleted-list"><li style="list-style-type:circle"><strong>NAT</strong> 활성화 되어 있는 <strong>wi-fi 네트워크</strong>에서 <strong>TCP 하이재킹</strong>: 시퀀스 번호 누출 공격</li></ul><ul id="181e8cfa-c68c-8090-b28c-e84b54b97b1a" class="bulleted-list"><li style="list-style-type:circle">wi-fi 라우터의 불충분한 역-경로 검증 취약점을 이용함</li></ul><ul id="181e8cfa-c68c-80f7-b60b-cebb0fc2c756" class="bulleted-list"><li style="list-style-type:circle">동일 네트워크에서 클라이언트와 외부 서버간 TCP 연결 여부를 off-path 공격자가 추론하고 하이재킹하는 방법</li></ul></li></ul><ul id="181e8cfa-c68c-8031-8706-f9366cac4584" class="bulleted-list"><li style="list-style-type:disc">과정<ol type="1" id="181e8cfa-c68c-80c4-bc9f-d488833ee544" class="numbered-list" start="1"><li>TCP 연결 탐지</li></ol><ol type="1" id="181e8cfa-c68c-8098-a365-dc55dbdb1b9f" class="numbered-list" start="2"><li>NAT 매핑 제거 및 재구성</li></ol><ol type="1" id="181e8cfa-c68c-8043-a619-f46da4c89bb8" class="numbered-list" start="3"><li>TCP 시퀀스 및 ACK 번호 획득 후 연결</li></ol><ol type="1" id="181e8cfa-c68c-80ad-b52a-cd218f769bcf" class="numbered-list" start="4"><li>결과<ol type="a" id="181e8cfa-c68c-80c6-a215-ced8268e23aa" class="numbered-list" start="1"><li>TCP 서비스 거부  공격 ⇒ <strong>DoS</strong></li></ol><ol type="a" id="181e8cfa-c68c-809a-bc02-e91aedd78f8b" class="numbered-list" start="2"><li>라우터 대신 공격자에게 패킷 전달자 역할을 맏기게 되어 <strong>TCP 하이재킹</strong></li></ol><ol type="a" id="181e8cfa-c68c-8029-899f-dfed7e6ec839" class="numbered-list" start="3"><li>스푸핑된 TCP RST 및 ACK 패킷 전달 과정에서 패킷 복원과 데이터 조작을 통한 <strong>TCP 트래픽 주입← </strong>단 HTTPS를 통한 암호화를 하면 해당 과정이 까다로워짐(통계상 20%는 안함)</li></ol></li></ol></li></ul><ul id="17fe8cfa-c68c-8041-9d0a-cf25573993d1" class="bulleted-list"><li style="list-style-type:disc">취약점 탐색 결과<ul id="181e8cfa-c68c-80f0-8d54-c0b61727b128" class="bulleted-list"><li style="list-style-type:circle">67개 라우터 모델중 52개가 취약, 93개 wi-fi 네트워크 중 81%가 공격에 취약하다고 함<p id="181e8cfa-c68c-801b-8ad5-e561bce940a9" class="">← 커피숍, 호텔, 서점, 기업의 wifi등을 찾아가 실제 해봤다고 함</p></li></ul><table id="181e8cfa-c68c-8021-af2a-defe8035031d" class="simple-table"><tbody><tr id="2140ca00-b16e-4c57-a085-4890207a7b00"><td id="X{~`" class="">서비스</td><td id="Qd{G" class="">탐지 시간</td><td id="To\x" class="">성공률</td></tr><tr id="e6805fa1-dc94-4331-83ee-015c3ae3028e"><td id="X{~`" class="">S노</td><td id="Qd{G" class="">17.5 s</td><td id="To\x" class="">87.4%</td></tr><tr id="a1958b2f-8689-4cad-b78e-f798e8cb231a"><td id="X{~`" class="">FTP</td><td id="Qd{G" class="">19.4 s</td><td id="To\x" class="">8.6%</td></tr><tr id="181e8cfa-c68c-80f9-9e0b-cfff895cca48"><td id="X{~`" class="">HTTP</td><td id="Qd{G" class="">54.5 s</td><td id="To\x" class="">76.1%</td></tr></tbody></table></li></ul><ul id="181e8cfa-c68c-8034-830d-f950a47c3052" class="bulleted-list"><li style="list-style-type:disc">결과<ul id="181e8cfa-c68c-802f-8533-fa05ea386c2d" class="bulleted-list"><li style="list-style-type:circle">해당 취약점 관련 업체와 OpenWrt 커뮤니티에 보고함, 일부는 패치 진행 중이라 함<ul id="181e8cfa-c68c-8047-869a-cfe7e2c0f2c1" class="bulleted-list"><li style="list-style-type:square">10개의 CVE 번호가 할당(CVE-2023-30305 to CVE-2023-30314)</li></ul></li></ul></li></ul><p id="17fe8cfa-c68c-804f-8fd0-f82fac40bc0c" class="">
</p><h1 id="181e8cfa-c68c-80b6-ad49-c8e5013c4f79" class="">Background</h1><ol type="1" id="181e8cfa-c68c-8088-b5d0-c162ba30e5ad" class="numbered-list" start="1"><li><strong>NAT 및 포트 할당 전략(NAT and Port Allocation Strategies)</strong><ul id="181e8cfa-c68c-8044-b074-f19b1b933ba4" class="bulleted-list"><li style="list-style-type:disc">NAT는 주소 부족 문제를 해결과 네트워크 토폴로지를 외부 엔터티로부터 숨기기 위해 개발된 기술임</li></ul><ul id="181e8cfa-c68c-8044-878a-d0fab54093f5" class="toggle"><li><details open=""><summary><em>NAT는 정확히 어떻게 이뤄지는거지?</em></summary><ul id="181e8cfa-c68c-805c-9493-c270c9c4299a" class="bulleted-list"><li style="list-style-type:disc"><strong>유형</strong><ul id="181e8cfa-c68c-805c-9a79-d7320fdc2561" class="bulleted-list"><li style="list-style-type:circle"><strong>Static NAT (고정 NAT):</strong><ul id="181e8cfa-c68c-8008-822c-f8cba38f6c49" class="bulleted-list"><li style="list-style-type:square">하나의 내부 IP 주소를 특정한 하나의 공인 IP 주소에 매핑.</li></ul><ul id="181e8cfa-c68c-80f1-9227-fc312d5037fa" class="bulleted-list"><li style="list-style-type:square">주로 서버나 고정된 연결이 필요한 장치에 사용.</li></ul></li></ul><ul id="181e8cfa-c68c-8075-ae00-d051154e906e" class="bulleted-list"><li style="list-style-type:circle"><strong>Dynamic NAT (동적 NAT):</strong><ul id="181e8cfa-c68c-802d-ad17-cce73af452e5" class="bulleted-list"><li style="list-style-type:square">여러 내부 IP 주소를 NAT 풀(pool)에 있는 공인 IP 주소 중 하나와 동적으로 매핑.</li></ul><ul id="181e8cfa-c68c-80e0-84a8-cd7e323b4888" class="bulleted-list"><li style="list-style-type:square">공인 IP 주소가 제한된 경우 사용.</li></ul></li></ul><ul id="181e8cfa-c68c-8021-b1d1-ea03ec18f310" class="bulleted-list"><li style="list-style-type:circle"><strong>PAT (Port Address Translation, 포트 주소 변환):</strong><ul id="181e8cfa-c68c-80a4-9dd3-c1aa59cedee5" class="bulleted-list"><li style="list-style-type:square">여러 내부 IP 주소가 하나의 공인 IP 주소를 공유하며 포트를 기준으로 구분.</li></ul><ul id="181e8cfa-c68c-80b8-b545-c6d8037fb74d" class="bulleted-list"><li style="list-style-type:square">NAT의 가장 일반적인 형태로, SOHO(Small Office/Home Office) 환경에서 주로 사용.</li></ul></li></ul></li></ul><ul id="181e8cfa-c68c-80b7-88ff-d4a8875ff19c" class="bulleted-list"><li style="list-style-type:disc"><strong>작동 과정</strong><ol type="1" id="181e8cfa-c68c-809e-8e0c-eb86f931140d" class="numbered-list" start="1"><li><strong>내부 호스트의 패킷 전송 (Outbound)</strong><ul id="181e8cfa-c68c-80cf-bbb5-fb10ec8b7df4" class="bulleted-list"><li style="list-style-type:disc">내부 네트워크의 호스트가 외부 네트워크로 패킷을 보냄.</li></ul><ul id="181e8cfa-c68c-801d-b13d-d7a8d773286e" class="bulleted-list"><li style="list-style-type:disc">라우터는 패킷의 사설 IP 주소와 포트를 NAT 매핑 테이블에 기록.</li></ul><ul id="181e8cfa-c68c-80ff-8d7e-d50eefd606d4" class="bulleted-list"><li style="list-style-type:disc">라우터는 패킷의 소스 IP 주소와 포트를 공인 IP 주소와 새로운 포트 번호로 변환.</li></ul></li></ol><ol type="1" id="181e8cfa-c68c-8089-88b9-e9aec62709eb" class="numbered-list" start="2"><li><strong>패킷 전송 (Outbound)</strong><ul id="181e8cfa-c68c-80a3-8bbf-cdab202e3779" class="bulleted-list"><li style="list-style-type:disc">변환된 패킷이 외부 네트워크로 전송됨.</li></ul><ul id="181e8cfa-c68c-806d-8c38-c5fdd79f9c78" class="bulleted-list"><li style="list-style-type:disc">외부 네트워크에서는 패킷의 공인 IP 주소를 확인하여 응답을 보냄.</li></ul></li></ol><ol type="1" id="181e8cfa-c68c-802b-84b5-d20d013bdef7" class="numbered-list" start="3"><li><strong>외부에서의 응답 패킷 (Inbound)</strong><ul id="181e8cfa-c68c-80a4-8f47-c116f5565cf8" class="bulleted-list"><li style="list-style-type:disc">외부 네트워크에서 응답 패킷을 라우터로 보냄.</li></ul><ul id="181e8cfa-c68c-800c-a8cb-e8ec7b5e976f" class="bulleted-list"><li style="list-style-type:disc">라우터는 NAT 매핑 테이블을 참조하여 공인 IP 주소와 포트 번호를 기반으로 원래의 사설 IP 주소와 포트 번호를 찾음.</li></ul><ul id="181e8cfa-c68c-8080-9749-c34990821d75" class="bulleted-list"><li style="list-style-type:disc">패킷의 대상 IP 주소와 포트를 변환하여 내부 호스트로 전달.</li></ul></li></ol></li></ul><ul id="181e8cfa-c68c-8093-ae27-fa64c3ae71d8" class="bulleted-list"><li style="list-style-type:disc"><strong>NAT 매핑 테이블 정보</strong><ul id="181e8cfa-c68c-80bf-9321-fbb5bc7ffecd" class="bulleted-list"><li style="list-style-type:circle">내부 IP 주소와 포트.</li></ul><ul id="181e8cfa-c68c-80cd-9d4c-c4a1d9f9ec81" class="bulleted-list"><li style="list-style-type:circle">외부(공인) IP 주소와 포트.</li></ul><ul id="181e8cfa-c68c-8092-b195-ec87b362c153" class="bulleted-list"><li style="list-style-type:circle">대상 IP 주소와 포트.</li></ul><ul id="181e8cfa-c68c-803a-8e86-ebc96cbb0848" class="bulleted-list"><li style="list-style-type:circle">프로토콜 (TCP/UDP).</li></ul><ul id="181e8cfa-c68c-804d-977e-c6cef7c79a4b" class="bulleted-list"><li style="list-style-type:circle">타임아웃 정보 (연결 유지를 위한 시간 설정).</li></ul></li></ul><ul id="181e8cfa-c68c-80a0-9453-f9eaace86578" class="bulleted-list"><li style="list-style-type:disc"><strong>예시</strong><ol type="1" id="181e8cfa-c68c-80e3-8f3b-e6087656a3a4" class="numbered-list" start="1"><li>내부 호스트(192.168.1.2)가 웹 서버(8.8.8.8)에 접속 요청을 보냄 (포트 1234 사용).</li></ol><ol type="1" id="181e8cfa-c68c-8099-80c6-fd0c33af51cc" class="numbered-list" start="2"><li>NAT 라우터가 내부 IP(192.168.1.2:1234)를 공인 IP(203.0.113.5:443)로 변환.</li></ol><ol type="1" id="181e8cfa-c68c-8056-b0ad-db7644e071c1" class="numbered-list" start="3"><li>웹 서버는 203.0.113.5:443 으로 응답을 전송.</li></ol><ol type="1" id="181e8cfa-c68c-80d0-a929-fe1a1b87eb6c" class="numbered-list" start="4"><li>NAT 라우터가 응답을 192.168.1.2:1234로 변환하여 내부 호스트로 전달.</li></ol></li></ul></details></li></ul><ul id="181e8cfa-c68c-80f2-97d0-e16120a5e395" class="bulleted-list"><li style="list-style-type:disc">TCP 매핑에 대한 NAT 동작 과정<ul id="181e8cfa-c68c-801a-9dd5-d7b3c62e8af9" class="bulleted-list"><li style="list-style-type:circle">내부 호스트가 외부 서버와의 연결을 시작시 라우터는 이를 테이블에 새 매핑으로 생성<p id="181e8cfa-c68c-80a8-a041-cccb7fb5d290" class="">⇒ <strong>바인딩</strong> 과정이라 함</p></li></ul><ul id="181e8cfa-c68c-8079-b359-ee31788296d2" class="bulleted-list"><li style="list-style-type:circle"><em><strong>이때 SYN 패킷 뿐만 아니라 PUSH와 ACK 플래그 패킷에서도 새 NAT 매핑을 유발 할 수 있음을 발견함</strong></em></li></ul><ul id="181e8cfa-c68c-802a-a436-eb46d312a20a" class="bulleted-list"><li style="list-style-type:circle">매핑은 변환 전후의 소스 <strong>IP 주소</strong> 및 <strong>포트</strong>, <strong>대상 IP 주소</strong> 및 <strong>포트</strong>, <strong>프로토콜</strong>, <strong>세션 상태 </strong>및 <strong>매핑 타임아웃</strong>과 같은 정보를 기록</li></ul><ul id="181e8cfa-c68c-809d-865b-f11a62c7bc4e" class="bulleted-list"><li style="list-style-type:circle">외부 서버에서 응답이 도착하면 매핑 정보에 따라 패킷을 내부 호스트로 전달, 상태를 업데이트 함</li></ul></li></ul><ul id="181e8cfa-c68c-806d-a374-f18992763a74" class="toggle"><li><details open=""><summary>NAT 내부 서버 포트 매칭 방법</summary><ol type="1" id="181e8cfa-c68c-806d-ba86-d5160f363ffa" class="numbered-list" start="1"><li>포트 보존 (Port Preservation)<ul id="181e8cfa-c68c-8065-b35f-fc4d015258d1" class="bulleted-list"><li style="list-style-type:disc">가능한 경우 원 소스 포트 유지, 충돌시 랜덤 포트 선택</li></ul></li></ol><ol type="1" id="181e8cfa-c68c-80ad-9351-d25afa611bff" class="numbered-list" start="2"><li>랜덤 선택 (Random Selection)<ul id="181e8cfa-c68c-8017-a02f-ec6c7e440fe9" class="bulleted-list"><li style="list-style-type:disc">가능한 포트 풀에서 무작위 포트 사용</li></ul></li></ol><ol type="1" id="181e8cfa-c68c-8068-b624-f948c6f38358" class="numbered-list" start="3"><li>순차 선택 (Sequential Selection)<ul id="181e8cfa-c68c-802a-b4b0-cf04466fc1bb" class="bulleted-list"><li style="list-style-type:disc">초기 연결에 랜덤 포트 할당, 이후 연결에서 순차적으로 포트 할당</li></ul></li></ol><ol type="1" id="181e8cfa-c68c-8051-8fb8-cb49dd553e74" class="numbered-list" start="4"><li>포트 과부하 (Port Overloading)<ul id="181e8cfa-c68c-80d6-99a4-c8cde921af4f" class="bulleted-list"><li style="list-style-type:disc">NAT 장치가 원 포트를 유지하려고 시도</li></ul><ul id="181e8cfa-c68c-80df-b22b-f441b6fd9325" class="bulleted-list"><li style="list-style-type:disc">충돌 발생시 기존 연결 삭제(기존 사용자연결 끊김)  후 최신 연결만 유지</li></ul></li></ol></details></li></ul><ul id="181e8cfa-c68c-8001-8106-c68d2fa0e925" class="toggle"><li><details open=""><summary>NAT 매핑 관리 및 타임 아웃</summary><ul id="181e8cfa-c68c-80d7-9bc9-c741811b3659" class="bulleted-list"><li style="list-style-type:disc">매핑 타임 아웃<ul id="181e8cfa-c68c-8050-9a5c-cd969e031838" class="bulleted-list"><li style="list-style-type:circle">비활성 NAT 매핑은 설정된 타임아웃 이후 제거</li></ul><ul id="181e8cfa-c68c-800f-8095-e880899b3d8f" class="bulleted-list"><li style="list-style-type:circle">RFC 5382 권장 타임아웃<ul id="181e8cfa-c68c-8016-b4d9-dfecfdadb32f" class="bulleted-list"><li style="list-style-type:square">ESTABLISHED 상태: 최소 2시간 4분</li></ul><ul id="181e8cfa-c68c-80b9-ba05-d951e1604bb2" class="bulleted-list"><li style="list-style-type:square">CLOSE 상태: 1초 or 10초(RST 패킷으로 전환될 경우)</li></ul></li></ul></li></ul><ul id="181e8cfa-c68c-80c6-afe3-d67497f132e7" class="bulleted-list"><li style="list-style-type:disc">연결 상태 추적<ul id="181e8cfa-c68c-809a-b710-c07c18bdf3e7" class="bulleted-list"><li style="list-style-type:circle">NAT는 TCP 연결 상태를 기반으로 매핑 상태를 업데이트함</li></ul><ul id="181e8cfa-c68c-804c-961c-e3aa8c122f03" class="bulleted-list"><li style="list-style-type:circle">상태 변화에 따라 적절한 타임아수을 적용</li></ul></li></ul></details></li></ul></li></ol><ol type="1" id="181e8cfa-c68c-80b3-a2bb-d697d2cb9dd2" class="numbered-list" start="2"><li><strong>라우터의 TCP 윈도우 추적(TCP Window Tracking in Routers)</strong><ul id="181e8cfa-c68c-80bb-9507-fc2f71423145" class="bulleted-list"><li style="list-style-type:disc">클라이언트와 서버 간의 중간 장치로서 라우터는 관련 호스트의 연결 정보를 기록하여 이후 패킷 전달에 사용해야 함</li></ul><ul id="181e8cfa-c68c-8088-99b7-e378a914d3c2" class="bulleted-list"><li style="list-style-type:disc">그러나 TCP는 처음부터 <strong>종단간 통신을 위해 설계</strong> 되었으며 중간 장치를 고려하지 않음<p id="181e8cfa-c68c-80dc-bccd-fb0831c8cb79" class="">→ 성능 문제로 인해 모든 정보 기록 하지 않음<div class="indented"><p id="181e8cfa-c68c-805c-84fa-c7add2b0dbe4" class="">→ 라우터는 연결된 TCP 윈도우를 추적하지 않기로 선택 가능하며, TCP패킷의 <strong>시퀀스번호</strong>와 <strong>확인 번호</strong>를 엄격히 확인하지 않음</p></div></p></li></ul><ul id="181e8cfa-c68c-80a2-83bb-d01fb12d2fb0" class="bulleted-list"><li style="list-style-type:disc">라우터 오픈소스 운영체제인 <strong>OpenWrt</strong> 및 <strong>AsusWrt</strong>는 CPU 오버헤드를 줄이기 위해 관련 옵션 제공<ul id="181e8cfa-c68c-8055-8770-d05ed8965f85" class="bulleted-list"><li style="list-style-type:circle"><strong>OpenWrt</strong> : <code>nf_conntrack_tcp_no_window_check</code><ul id="181e8cfa-c68c-8088-a88b-d69128e75dd5" class="bulleted-list"><li style="list-style-type:square">패킷의 시퀀스 번호를 전혀 확인하지 않음</li></ul></li></ul><ul id="181e8cfa-c68c-8078-a427-dc618bf1406c" class="bulleted-list"><li style="list-style-type:circle"><strong>AsusWrt : </strong><code>ip_conntrack_tcp_be_liberal</code><ul id="181e8cfa-c68c-8049-9a5b-e737b2862b6a" class="bulleted-list"><li style="list-style-type:square">현재 시퀸스 번호에서 2G 공간을 벗어나는지에 대한 여부만 확인함</li></ul></li></ul><ul id="181e8cfa-c68c-8029-9f5d-c1c46c7eb7de" class="bulleted-list"><li style="list-style-type:circle">위 옵션들은 기본적으로 활성화 되어 있으며, 이때 Netfilter는 원래 Linux 커널과 달리 윈도우 추적을 수행하지 않음(일반적인 Linux 커널에서는 윈도우 추적함→ 시퀀스 번호를 엄격히 검증)</li></ul><ul id="181e8cfa-c68c-801f-8d8d-c578c692df09" class="toggle"><li><details open=""><summary><strong>TCP 시퀀스 번호란?</strong></summary><ul id="181e8cfa-c68c-80fe-a047-e6689d092689" class="bulleted-list"><li style="list-style-type:disc">데이터 전송의 순서와 무결성을 보장하기 위해 시퀀스 번호를 사용</li></ul><ul id="181e8cfa-c68c-808b-8d53-c9347c45adf5" class="bulleted-list"><li style="list-style-type:disc">송신자가 데이터를 전송할 때 시퀀스 번호를 포함하며, 수신자는 이를 확인하여 데이터의 순서를 보장</li></ul><ul id="181e8cfa-c68c-80ec-bf7d-c6c282bdee5f" class="bulleted-list"><li style="list-style-type:disc">본래 라우터는 패킷 전달말 하기에 시퀀스 번호 검증은 안함</li></ul><ul id="181e8cfa-c68c-805d-babe-fdc6eb0c4f8f" class="bulleted-list"><li style="list-style-type:disc">단, 방화벽(Netfilter)같은 보안기능 활성화시 시퀀스 번호 검증하여 비정상 패킷을 차단함</li></ul><ul id="181e8cfa-c68c-80b3-9702-d3b79f5eaf31" class="bulleted-list"><li style="list-style-type:disc">이는 CPU 오버헤드를 증가시킴</li></ul></details></li></ul><ul id="181e8cfa-c68c-8038-b187-fc443765b2a0" class="bulleted-list"><li style="list-style-type:circle">시장의 대부분의 라우터도 성능상의 문제로 인해 TCP 윈도우 추적 전략을 off해 놓음</li></ul></li></ul><ul id="181e8cfa-c68c-802d-9920-eab6dd6b2683" class="bulleted-list"><li style="list-style-type:disc">해당 논문에서는<strong> OpenWrt 기반 라우터 및 유사 설정을 가진 라우터를 목표</strong>로 잡음</li></ul><ul id="181e8cfa-c68c-80c7-9f0e-f8cb04d867cf" class="bulleted-list"><li style="list-style-type:disc"><strong>OpenWrt</strong> 기반인 경우 <p id="181e8cfa-c68c-80f7-baf5-e6e162918788" class="">→ 공격자는 임의의 시퀀스 번호를 가진 하나의 위조 RST 패킷을 사용하여 매핑을 정리 가능</p></li></ul><ul id="181e8cfa-c68c-8019-ba36-d937c08a6b35" class="bulleted-list"><li style="list-style-type:disc"><strong>AsusWrt </strong>기반인 경우 <p id="181e8cfa-c68c-803a-b2ab-f332f328a34b" class="">→ 2G 간격의 두 시퀀스 번호를 가진 두 개의 RST 패킷을 위조하여 범위 검사를 우회 가능</p></li></ul></li></ol><ol type="1" id="181e8cfa-c68c-8008-9585-ec7944a4c3b1" class="numbered-list" start="3"><li><strong>역경로 검증(Reverse Path Validation)</strong><ul id="181e8cfa-c68c-80c9-81f8-df10b4a335ac" class="bulleted-list"><li style="list-style-type:disc">IP 스푸핑 공격을 방지하고 소스 기반 주소 검증 프로세스를 위해 RFC 2827 및 RFC 3704는 역경로 검증 개념을 제안했음</li></ul><ul id="181e8cfa-c68c-8029-ba2e-fe4d64baea0d" class="bulleted-list"><li style="list-style-type:disc">수신된 패킷의 소스 IP 주소가 수신된 인터페이스를 통해 라우팅 테이블에 따라 다시 라우팅될 수 있는지 확인하여 패킷의 진위를 검증</li></ul><ul id="181e8cfa-c68c-8036-89ec-deecef9b45e3" class="bulleted-list"><li style="list-style-type:disc">해당 전략이 활성화 된 경우 패킷이 수신 인터페이스에서 역경로로 라우팅 될 수 있을 때만 커널에 의해 처리되고 목적지로 라우팅 되며 그렇지 않은 경우 드롭됨</li></ul><ul id="181e8cfa-c68c-8099-be35-ea75bc21c4bf" class="toggle"><li><details open=""><summary>대부분의 Linux 기반 시스템은 <code>rp_filter</code> 이라는 커널 변수를 통해 해당 전략 제어함</summary><ul id="181e8cfa-c68c-8018-81d0-ce7cd3da4524" class="bulleted-list"><li style="list-style-type:disc"><strong>0 </strong>: 소스기반 주소 검증이 비활성화</li></ul><ul id="181e8cfa-c68c-80f7-82d4-c51f66212217" class="bulleted-list"><li style="list-style-type:disc"><strong>1 (Strict Mode)</strong> : <ul id="181e8cfa-c68c-809e-9f84-cd5e069d84d5" class="bulleted-list"><li style="list-style-type:circle">RFC 3704에 정의된 엄격 모드</li></ul><ul id="181e8cfa-c68c-802b-a88a-cd08efd7555a" class="bulleted-list"><li style="list-style-type:circle">장치는 들어오는 패킷의 소스 주소를 포워딩 정보 베이스(FIB)와 비교 </li></ul><ul id="181e8cfa-c68c-806a-8a93-c35a2ac13bea" class="bulleted-list"><li style="list-style-type:circle">만약 들어오는 인터페이스가 <strong>최적의 역경로가 </strong>아니면 패킷이 드롭</li></ul></li></ul><ul id="181e8cfa-c68c-8072-8b17-cbbec2853ef6" class="bulleted-list"><li style="list-style-type:disc"><strong>2 (Loose Mode) </strong>: <ul id="181e8cfa-c68c-8029-a9b3-d55cf9fbc3c7" class="bulleted-list"><li style="list-style-type:circle">RFC 3704에 정의된 느슨한 모드</li></ul><ul id="181e8cfa-c68c-80ce-b10f-f93bbcc1872f" class="bulleted-list"><li style="list-style-type:circle">들어오는 패킷의 소스 주소를 FIB와 비교</li></ul><ul id="181e8cfa-c68c-800b-978f-e33a5380a519" class="bulleted-list"><li style="list-style-type:circle">패킷이 어떤 인터페이스를 통해서도 도달할 수 없다면 드롭</li></ul></li></ul></details></li></ul><ul id="181e8cfa-c68c-801b-9be7-e3a5f08e16ae" class="bulleted-list"><li style="list-style-type:disc">VPN 환경에서 라우터의 역경로 검증이 없을 경우 공격자가 네트워크 연결을 하이재킹하거나 비활성화 할 수 있음</li></ul><ul id="181e8cfa-c68c-807c-94bf-ef86e195e6f1" class="bulleted-list"><li style="list-style-type:disc">대부분의 라우터가 권장 사항을 준수하지 않으며, NAT 매핑에서 연결과 일치하는 스푸핑된 소스 주소를 가진 패킷을 드롭하지 않고 모든 인터페이스에서 이를 수락한다는 것을 발견다함 ⇒ <strong>즉 앞으로의 논문은 RFC 3704에 정의된 준수사항을 어기는 환경을 가정하는것임</strong></li></ul><ul id="181e8cfa-c68c-8021-a04a-da4a67943445" class="bulleted-list"><li style="list-style-type:disc"><strong>해당 논문은 off-path 공격자가 역경로 검증 없이 스푸핑된 SYN/ACK 패킷을 보낼 수 있음을 검증하는것</strong></li></ul></li></ol><h1 id="181e8cfa-c68c-80f0-82d5-c3cd13674fc2" class="">Threat Model</h1><ul id="181e8cfa-c68c-8015-8676-cd732f371287" class="bulleted-list"><li style="list-style-type:disc">공격 조건<ul id="181e8cfa-c68c-80b4-a292-d8593335bd3b" class="bulleted-list"><li style="list-style-type:circle">AP isoaltion 상태가 꺼져야함<ul id="181e8cfa-c68c-808e-8d2c-e7fa9d967698" class="bulleted-list"><li style="list-style-type:square">Nmap과 MacStealer 내부 네트워크스캔 가능</li></ul><ul id="181e8cfa-c68c-8015-bda4-f832406a2a52" class="bulleted-list"><li style="list-style-type:square">RFC 3704와 동일하게 스푸핑 방지의 역할을 함</li></ul><ul id="181e8cfa-c68c-80f9-b1a6-ec21c1b2a138" class="bulleted-list"><li style="list-style-type:square">off ⇒ TCP DoS 및 TCP 하이재킹 공격 가능</li></ul><ul id="181e8cfa-c68c-8066-b3b0-c20a385503aa" class="bulleted-list"><li style="list-style-type:square">on ⇒ TCP 주입(TCP injection) 공격은 방해받으나 DoS와 TCP 하이재킹은 가능</li></ul></li></ul><ul id="181e8cfa-c68c-8090-9524-fd9a44b5f54d" class="bulleted-list"><li style="list-style-type:circle"><strong>라우터가 포트 보존 전략이 설정되야함</strong><ul id="181e8cfa-c68c-803f-a228-f74f76761061" class="bulleted-list"><li style="list-style-type:square">대부분의 라우터가 해당 전략 채택함(Huawei나 pfSense 오픈소스 펌웨어 제외)</li></ul><ul id="181e8cfa-c68c-8049-90c8-c05833f520c7" class="bulleted-list"><li style="list-style-type:square"><strong>라우터는 역경로 검증이 비활성화 되어야함</strong><p id="181e8cfa-c68c-80cb-9896-d587d87c8dce" class="">→ 조사한 30개중 24개가 비활성화 되어 있음</p></li></ul><ul id="181e8cfa-c68c-808c-acc2-d35e4e4d057b" class="bulleted-list"><li style="list-style-type:square">TCP 윈도우 추적 전략 비활성화<p id="181e8cfa-c68c-8028-b0ce-eb4e3892d7d7" class="">→ Cisco Meraki를 제외한 대부분의 라우터 비활성화 함</p></li></ul></li></ul><ul id="181e8cfa-c68c-8073-b48e-c7419bb6ca29" class="bulleted-list"><li style="list-style-type:circle">피해 클라이언트는 서버와 자주 통신하지 않음<ul id="181e8cfa-c68c-8000-aca7-d6ab3b56434f" class="bulleted-list"><li style="list-style-type:square">NAT 매핑의 상태는 해당 TCP RST 패킷을 수신한 후 설정된 상태에서 종료 상태로 전환됨</li></ul><ul id="181e8cfa-c68c-8094-8b72-fdd62faeb2d9" class="bulleted-list"><li style="list-style-type:square">이때 매핑 타임아웃(1~10s) 후에 완전히 제거됨</li></ul><ul id="181e8cfa-c68c-80f3-a525-df2839d7a3ee" class="bulleted-list"><li style="list-style-type:square">해당 기간동안 클라이언트의 통신이 계속 되면 매핑이 새로 고침되므로 공격에 방해됨</li></ul><ul id="181e8cfa-c68c-80ed-9e61-d74c4d46a3ba" class="bulleted-list"><li style="list-style-type:square">평균적으로 TCP 연결이 오래 지속되며 데이터 통신이 수분에 한번 일어났으며 테스트한 라우터의 42%의 라우터가 1초의 타임아웃을 가지고 있었음<p id="181e8cfa-c68c-801b-b0c8-d2e1b023b7b4" class="">→ 공격자는 공격하기 적절한 시간을 가질 수 있었음</p></li></ul></li></ul></li></ul><ul id="181e8cfa-c68c-8081-8110-d8fd8d34ca8f" class="bulleted-list"><li style="list-style-type:disc">라우터의 외부 IP 주소 탐색<ul id="181e8cfa-c68c-800b-bf1e-e72c14234de4" class="bulleted-list"><li style="list-style-type:circle"><code>RECORD_ROUTE</code> 를 통한 traceroute와 ping</li></ul><ul id="181e8cfa-c68c-80e6-ba04-ff634f7b0b78" class="bulleted-list"><li style="list-style-type:circle">웹 브라우저를 통해 IP를 스캔하고 액세스</li></ul></li></ul><p id="181e8cfa-c68c-80e5-9c04-fdc7e82e53d9" class="">
</p><h1 id="181e8cfa-c68c-8069-92c8-c7ba0d570c75" class="">Attack Procedure</h1><ul id="181e8cfa-c68c-804d-bef4-c40b53cd950b" class="bulleted-list"><li style="list-style-type:disc">공격 과정 요약<ol type="1" id="181e8cfa-c68c-8033-85e8-d3b041289d23" class="numbered-list" start="1"><li><strong>네트워크 탐색: </strong>라우터 외부 IP 주소 확인, AP 격리상태 식별을 통해 잠재적인 피해 클라이언트 탐색</li></ol><ol type="1" id="181e8cfa-c68c-80aa-b4b4-dd3f56678772" class="numbered-list" start="2"><li><strong>활성화된 연결에 대한 추론: </strong>LAN에서 서버로의 활성화된 연결이 있는지 탐색</li></ol><ol type="1" id="181e8cfa-c68c-80c3-a174-dfcae6811bec" class="numbered-list" start="3"><li><strong>활성 연결에 대한 추론: </strong>라우터에서 NAT 매핑 제거, 새로운 매핑 생성 후 서버에서 수신한 응답 패킷의 시퀀스 번호와 확인 번호 하이재킹</li></ol><ul id="181e8cfa-c68c-80bb-93fb-edb96d8d8928" class="bulleted-list"><li style="list-style-type:circle">위 단계 수행시 공격자는 DoS, TCP Hijaking, TCP Injection 가능</li></ul></li></ul><ol type="1" id="181e8cfa-c68c-80a0-9c21-e21a923983f8" class="numbered-list" start="1"><li><strong>네트워크 탐색</strong><ul id="181e8cfa-c68c-804b-8e74-fceeed47cdf5" class="bulleted-list"><li style="list-style-type:disc"><strong>AP 격리 상태 확인</strong><ul id="181e8cfa-c68c-8041-8b1c-d79d89d2c7b7" class="bulleted-list"><li style="list-style-type:circle">Nmap과 MacStealer를 통해 네트워크 스캔, AP 격리 상태 확인</li></ul><ul id="181e8cfa-c68c-80e9-9bbf-cc4fb87f6b4c" class="bulleted-list"><li style="list-style-type:circle">비활성 된 경우 공격자는 잠재적인 피해 클라이언트 기록</li></ul><ul id="181e8cfa-c68c-803b-b27a-e3f3e947da55" class="bulleted-list"><li style="list-style-type:circle">여태까지 연구된 방법과 달리 클라이언트의 정확한 사설 IP주소를 알 필요가 없음<p id="181e8cfa-c68c-805c-9dbc-f71823151990" class="">⇒ 라우터의 NAT 매핑 테이블을 조작하는 것이기 때문<div class="indented"><p id="181e8cfa-c68c-80a9-80e4-c743219599f8" class="">피해자가 기존에 통신하던 목적지에 가는 패킷으로 위조할려면 내부망인 wi-fi에서 외부로 나가는 router에서 NAT를 통해 인터넷과 연결됨 이때 포트 번호를 통해</p></div></p></li></ul></li></ul><ul id="181e8cfa-c68c-8090-92b2-d33918dd824c" class="bulleted-list"><li style="list-style-type:disc"><strong>라우터 외부 IP 주소 탐색</strong><ol type="1" id="181e8cfa-c68c-8096-9b63-c091612a6b57" class="numbered-list" start="1"><li>공격자가 Tracerout를 사용하여 외부 호스트 까지의 경로에 있는 게이트 웨이 식별<br/>record route 옵션을 통해 두번째 게이트웨이에 ping 실행, 경로를 기록<br/>⇒ 지나간 모든 인터페이스의 IP 주소 확인 가능<br/></li></ol><ol type="1" id="181e8cfa-c68c-807a-aa43-df250e49b2f4" class="numbered-list" start="2"><li>게이트웨이에 ping을 사용해도 경로가 반환되지 않는 경우<br/>게이트웨이 서브넷을 스캔, 활성 호스트의 IP 주소를 식별 가능<br/>라우터의 외부 IP에 접근하면 라우터 설정 페이지(Web GUI)가 표시되므로 위 방법들로 확인 가능<br/></li></ol></li></ul></li></ol><ol type="1" id="181e8cfa-c68c-80c2-9cf6-fb8767dcc413" class="numbered-list" start="2"><li><strong>활성화된 연결에 대한 추론</strong><figure id="181e8cfa-c68c-80b4-85c3-c619fc65dfd9" class="image"><a href="image.png"><img style="width:624px" src="image.png"/></a></figure><ol type="1" id="181e8cfa-c68c-80cd-b073-c184c2a82910" class="numbered-list" start="0"><li>희생자의 포트번호는 m, 공격자가 추측한 포트번호를 n으로 가정</li></ol><ol type="1" id="181e8cfa-c68c-8001-a8f4-e59a912c861f" class="numbered-list" start="1"><li>n ≠ m일 시<ol type="a" id="181e8cfa-c68c-80ef-b300-c99bb2b8a7f0" class="numbered-list" start="1"><li>SYN 패킷 전송<ul id="181e8cfa-c68c-80a6-b11d-e2530843840f" class="bulleted-list"><li style="list-style-type:disc">공격자IP:n 으로 SYN 패킷 전송</li></ul><ul id="181e8cfa-c68c-80f1-b16b-d7e01955c81a" class="bulleted-list"><li style="list-style-type:disc">라우터는 새로운 포트번호를 받아 새로운 NAT 매핑을 생성하게 됨<p id="181e8cfa-c68c-803c-b8b6-f74f28c76a3a" class="">⇒ 공격자IP:n ↔ 라우터_외부IP:n 의 형태로 new 매핑 정보 저장됨</p></li></ul></li></ol><ol type="a" id="181e8cfa-c68c-80c3-9826-f625a7903033" class="numbered-list" start="2"><li>위조된 SYN/ACK 패킷 전송<ul id="181e8cfa-c68c-801b-a573-fad0ca433c96" class="bulleted-list"><li style="list-style-type:disc">서버를 가장하여 SYN/ACK 패킷 위조하여 목적 포트 n으로  패킷을 라우터에게 보냄</li></ul><ul id="181e8cfa-c68c-801e-ad2a-dd1d79f742d8" class="bulleted-list"><li style="list-style-type:disc">라우터는 패킷의 포트n을 참조하여 NAT 매핑 확인</li></ul><ul id="181e8cfa-c68c-80f0-9f32-d2041b5a4012" class="bulleted-list"><li style="list-style-type:disc">공격자의 IP로 연결</li></ul></li></ol><ol type="a" id="181e8cfa-c68c-80ae-94c7-d3eb7db02d02" class="numbered-list" start="3"><li>공격자가 위조 SYN/ACK 패킷 수신<ul id="181e8cfa-c68c-8033-8865-dae9f33b631e" class="bulleted-list"><li style="list-style-type:disc">따라서 공격자는 위조된 SYN/ACK 패킷을 수신하게 됨</li></ul></li></ol></li></ol><ol type="1" id="181e8cfa-c68c-8057-9cbf-d460473965f5" class="numbered-list" start="2"><li>n =m 일 시<ol type="a" id="181e8cfa-c68c-802a-bd9c-fead3c6e53ff" class="numbered-list" start="1"><li>SYN 패킷 전송<ul id="77ef3dc0-de9d-4378-8401-3699cacd9ff4" class="bulleted-list"><li style="list-style-type:disc">공격자IP:n 으로 SYN 패킷 전송</li></ul><ul id="181e8cfa-c68c-8064-a1aa-f4d8b0f1f222" class="bulleted-list"><li style="list-style-type:disc">피해자가 이미 m을 사용중임<p id="181e8cfa-c68c-809b-ae9e-cbf0c85f3532" class="">⇒ NAT 매핑 충돌이 발생 라우터는 NAT테이블에 “공격자IP:m’”으로 저장함</p></li></ul></li></ol><ol type="a" id="181e8cfa-c68c-80fb-9a00-d91c212e5dae" class="numbered-list" start="2"><li>위조된 SYN/ACK 패킷 전송<ul id="9c6c852a-aedf-4424-b49c-3ead5e6d649f" class="bulleted-list"><li style="list-style-type:disc">서버를 가장하여 SYN/ACK 패킷 위조하여 목적 포트 n으로  패킷을 라우터에게 보냄</li></ul><ul id="1c4899df-8e3b-43de-b051-777e53ed5b0b" class="bulleted-list"><li style="list-style-type:disc">라우터는 패킷의 포트n을 참조하여 NAT 매핑 확인</li></ul><ul id="181e8cfa-c68c-80db-8c39-c27278575324" class="bulleted-list"><li style="list-style-type:disc">희생자의 IP로 연결됨</li></ul></li></ol><ol type="a" id="181e8cfa-c68c-8016-b454-de29acaf5e89" class="numbered-list" start="3"><li>공격자가 위조 SYN/ACK 패킷을 수신하지 못함<ul id="181e8cfa-c68c-8015-ac74-ca6575f29ba5" class="bulleted-list"><li style="list-style-type:disc">위조 패킷은 희생자에게 넘어가게되며 따라서 공격자는 위조 패킷을 수신할 수 없음</li></ul><ul id="181e8cfa-c68c-8031-9c09-d84df2564ffc" class="bulleted-list"><li style="list-style-type:disc">m’이 뭔지는 상관이 없음. 왜냐하면 결국에 공격자한테 패킷이 안 올때까지 보내면 되니까. 다음 위조패킷 p를 보낸다 할 때  만약 m’과 곂치게 되면 결국에 공격자에게 위조 패킷이 오게 됨 따라서 그냥 계속 돌려보면 됨</li></ul></li></ol><p id="181e8cfa-c68c-807c-808f-ffacf51a9fe2" class="">
</p></li></ol><ul id="181e8cfa-c68c-808f-933d-eb8be8bc8a9a" class="bulleted-list"><li style="list-style-type:disc">공격자는 자신의 IP로 추측한 포트 번호 <strong>n</strong>을 사용하여 서버로 SYN 패킷을 보냄</li></ul></li></ol><ol type="1" id="181e8cfa-c68c-808a-bcdf-fb2ed11a62a2" class="numbered-list" start="3"><li><strong>활성화된 TCP 연결에 대한 하이재킹</strong><figure id="181e8cfa-c68c-8080-8e1b-c04cf2993321" class="image"><a href="image%201.png"><img style="width:679.984375px" src="image%201.png"/></a></figure><ul id="181e8cfa-c68c-80bc-8f7a-efd3169b2cfc" class="bulleted-list"><li style="list-style-type:disc">목표<ul id="181e8cfa-c68c-8015-b825-ea504da0863c" class="bulleted-list"><li style="list-style-type:circle">서버의 현재 시퀀스 번호와 인증 번호 획득 시도</li></ul><ul id="181e8cfa-c68c-803c-a256-d8dd8e025603" class="bulleted-list"><li style="list-style-type:circle">TCP는 양방향 대칭(full-duplex) 프로토콜이기 때문에 피해자 클라이언트의 시퀀스 번호와 ACK 번호는 서버의 값과 대칭적으로 대응됨</li></ul></li></ul><ul id="181e8cfa-c68c-8078-a7b3-e2e804247700" class="bulleted-list"><li style="list-style-type:disc">기존 연구와의 차이점<ul id="181e8cfa-c68c-8040-a85f-c5a5394c35b5" class="bulleted-list"><li style="list-style-type:circle">기존 연구에서는 4GB의 전체 시퀀스 번호 공간을 탐색하며 부채널(side channel)을 활용하여 SEQ와 ACK 값을 추론하는 방식을 주로 사용함<p id="181e8cfa-c68c-8074-b45e-e809532f7c1c" class="">⇒ 매우 오래 걸림</p></li></ul><ul id="181e8cfa-c68c-8072-842c-fb8a7546cafe" class="bulleted-list"><li style="list-style-type:circle">TCP 윈도우 추적이 비활성화된 취약한 라우터를 악용하여 SEQ와 ACK 값을 <strong>직접적이고 정밀하게</strong> 획득하는 새로운 방법을 제안</li></ul></li></ul><ul id="181e8cfa-c68c-8012-b435-e360027e241e" class="bulleted-list"><li style="list-style-type:disc">기본 가정<ul id="181e8cfa-c68c-801d-b5a7-da8c42b8a7a4" class="bulleted-list"><li style="list-style-type:circle">클라이언트와 서버 간 통신에는 간격(interval)이 존재한다고 가정합니다.<p id="181e8cfa-c68c-80d3-b1bd-d1066025f744" class="">ex) 클라이언트가 주기적으로 요청을 보내고 서버의 응답을 기다림<div class="indented"><p id="181e8cfa-c68c-8042-829a-dd72308ba799" class="">서버가 알림 메시지를 능동적으로 푸시 함</p></div></p></li></ul></li></ul><ul id="181e8cfa-c68c-80de-981a-c5d5e14a0605" class="bulleted-list"><li style="list-style-type:disc"><strong>공격 단계</strong><ol type="1" id="181e8cfa-c68c-80ff-8bc6-f4c96c447237" class="numbered-list" start="1"><li>NAT 매핑 제거(TCP RST 패킷 전송)<ul id="181e8cfa-c68c-808d-8f4c-d4f6f3a09b88" class="bulleted-list"><li style="list-style-type:disc">발송지ip는 서버로, 포트는 2번째 단계에서 추측한 포트로 위조하여 라우터 외부로 패킷을 날림</li></ul><ul id="181e8cfa-c68c-80d1-824d-e20c1dd25bc2" class="bulleted-list"><li style="list-style-type:disc">라우터 동작에 따른 패킷 type<ul id="181e8cfa-c68c-80e7-9449-f52d7329d733" class="bulleted-list"><li style="list-style-type:circle">Type 1: 시퀀스 번호를 전혀 확인하지 않는 라우터<ul id="181e8cfa-c68c-8080-bd7f-ec2372131716" class="bulleted-list"><li style="list-style-type:square">임의의 시퀀스 번호를 가진 RST 패킷 1개로 NAT 매핑 제거</li></ul></li></ul><ul id="181e8cfa-c68c-8067-9a01-c303cdf659f9" class="bulleted-list"><li style="list-style-type:circle">Type 2: 시퀀스 번호가 2GB 범위를 초과하는지만 확인하는 라우터<ul id="181e8cfa-c68c-80c2-a3cd-dbe569802217" class="bulleted-list"><li style="list-style-type:square">두개의 RST 패킷 전송을 통한 </li></ul><ul id="181e8cfa-c68c-80fe-b915-e31a2b0cff78" class="bulleted-list"><li style="list-style-type:square">시퀀스 번호 <strong>x</strong>를, 다른 하나는 <strong>(x + 2G) % 4G</strong>를 사용해 전송하여, 이 중 하나가 요구 범위 내에 포함되도록 보장함<p id="181e8cfa-c68c-8011-b1a4-c55d13838211" class="">→ 두 개 중 하나는 무조건 됨(2GB 범위 이내에 있기 때문)</p><p id="181e8cfa-c68c-807a-a3b8-f244b90544cc" class="">⇒ 기존의 TCP hijaking 전략임</p></li></ul></li></ul></li></ul><ul id="181e8cfa-c68c-801a-af43-c036d3992f7f" class="bulleted-list"><li style="list-style-type:disc">RST 패킷을 받은 라우터는 역경로 검증을 수행하지 않음<p id="181e8cfa-c68c-8053-ac05-e100db3b52ee" class="">→ TCP 매핑 상태를 <code>ESTABLISHED</code>에서 <code>CLOSE</code>로 변경</p></li></ul><ul id="181e8cfa-c68c-8018-900b-d4a4316fc0db" class="bulleted-list"><li style="list-style-type:disc"><code>CLOSE</code> 상태 유지 시간<ul id="181e8cfa-c68c-8012-bbd7-d503ee503232" class="bulleted-list"><li style="list-style-type:circle">대부분의 라우터는 이 상태를 특정 타임 아웃동안 유지<ul id="181e8cfa-c68c-801a-8f14-ed70e0d3f003" class="bulleted-list"><li style="list-style-type:square">위에서 설명한 <strong>OpenWrt</strong> : <code>nf_conntrack_tcp_no_window_check</code> 을 의미</li></ul></li></ul><ul id="181e8cfa-c68c-8032-a15b-eb3f32364543" class="bulleted-list"><li style="list-style-type:circle">실험 결과 <strong>테스트한 라우터의 약 41%가 해당 값을 1초로 설정</strong> 나머지는 10초로 설정함</li></ul></li></ul></li></ol><ol type="1" id="181e8cfa-c68c-8062-a134-d509dc18116c" class="numbered-list" start="2"><li>NAT 매핑 재구성(위조된 PUSH/ACK 패킷 전송)<ul id="181e8cfa-c68c-802e-afa4-ea48c9e7a168" class="bulleted-list"><li style="list-style-type:disc">타임 아웃 후 NAT 매핑이 제거될 시 공격자는 위조된 PUSH/ACK 패킷을 서버로 보내 새로운 매핑 생성</li></ul><ul id="181e8cfa-c68c-803f-977b-d1ce668e295f" class="bulleted-list"><li style="list-style-type:disc">패킷 세부 정보<table id="181e8cfa-c68c-80ac-8a28-eba2adefb843" class="simple-table"><tbody><tr id="faab2d95-eb99-4dbc-a204-252051ae593d"><td id="Uoop" class=""><strong>속성</strong></td><td id="tSVo" class=""><strong>설정값</strong></td></tr><tr id="71f82e81-5498-46c7-a432-8013d7e760bb"><td id="Uoop" class="">Src IP</td><td id="tSVo" class="">공격자의 사설 IP</td></tr><tr id="0dc7d98d-2138-4a18-b294-b974f23fb141"><td id="Uoop" class="">포트번호</td><td id="tSVo" class="">m</td></tr><tr id="181e8cfa-c68c-8084-a7ca-f462d04005bf"><td id="Uoop" class="">시퀀스 및 ACK 번호</td><td id="tSVo" class="">임의 값</td></tr></tbody></table></li></ul><ul id="181e8cfa-c68c-8069-a77a-d346fd008a6f" class="bulleted-list"><li style="list-style-type:disc">라우터는 해당 패킷의 IP 변환하여 서버로 전달함</li></ul><ul id="181e8cfa-c68c-80dc-acac-d5d7c4f51b0f" class="bulleted-list"><li style="list-style-type:disc">서버는 잘못된 시퀀스 번호를 보고 <strong>정확한 SEQ, ACK 번호</strong>를 포함한 <strong>ACK 패킷</strong>을 반환</li></ul><ul id="181e8cfa-c68c-80b2-a666-e7e2f2ff1060" class="bulleted-list"><li style="list-style-type:disc">위 패킷은 라우터의 새로운 NAT 매핑에 따라 공격자에게 전달됨</li></ul></li></ol><ol type="1" id="181e8cfa-c68c-8085-a841-c9075a29bfe6" class="numbered-list" start="3"><li>공격 수행<ol type="a" id="181e8cfa-c68c-8075-8afe-cb185e58a252" class="numbered-list" start="1"><li>TCP DoS Attack<ul id="181e8cfa-c68c-80e5-a75f-d50493de72ce" class="bulleted-list"><li style="list-style-type:disc">위조한 TCP RST 패킷을 서버로 전송, 연결을 강제 종료 시킬 수 있음</li></ul><ul id="181e8cfa-c68c-8070-accc-f204215e2b5b" class="bulleted-list"><li style="list-style-type:disc">이를 통해 클라이언트는 서비스 거부 상태(DoS)가 됨</li></ul></li></ol><ol type="a" id="181e8cfa-c68c-8029-9d48-d1a96c264b2d" class="numbered-list" start="2"><li>TCP hijacking attack<ul id="181e8cfa-c68c-8045-a39d-fe962ae1507c" class="bulleted-list"><li style="list-style-type:disc">공격자는 NAT 매핑을 장악하고 피해자 클라이언트를 가장하여 서버에 요청을 전송하고 응답을 받을 수 있음</li></ul><ul id="181e8cfa-c68c-8090-a0fb-ddb0e8ec952b" class="bulleted-list"><li style="list-style-type:disc">일종의 Session Tackeover임</li></ul></li></ol><ol type="a" id="181e8cfa-c68c-807e-a84f-c970b5f41739" class="numbered-list" start="3"><li>TCP injection<ul id="181e8cfa-c68c-8095-8f64-ee051e92e339" class="bulleted-list"><li style="list-style-type:disc">공격자는 서버를 가장하여 피해자가 요청을 보낼 때 위조된 응답을 클라이언트에 전달</li></ul><ul id="182e8cfa-c68c-80cd-8311-ee83fa23fd56" class="toggle"><li><details open=""><summary>위 경우 공격자는 클라이언트의 NAT 매핑을 복원해야함 순서는 아래와 같음</summary><ol type="1" id="182e8cfa-c68c-809b-a169-c5b833dd0891" class="numbered-list" start="1"><li>기존 NAT 매핑 복구<ol type="a" id="182e8cfa-c68c-80b0-8ee8-df6d89a8c51f" class="numbered-list" start="1"><li>서버로 위조한 ACK 패킷 클라이언트의 사설 IP와 포트로 전송</li></ol><ol type="a" id="182e8cfa-c68c-800f-878f-d47fa9484527" class="numbered-list" start="2"><li>클라이언트는 위조된 패킷 처리, 서버로 ACK 패킷 전송</li></ol><ol type="a" id="182e8cfa-c68c-8059-8263-e0eadc5cddad" class="numbered-list" start="3"><li>NAT 테이블 복원됨!</li></ol></li></ol><ol type="1" id="182e8cfa-c68c-80ed-8c84-f18ecf73e5bb" class="numbered-list" start="2"><li>위조된 응답 생성</li></ol><ol type="1" id="182e8cfa-c68c-806e-b5a0-dd040962ec68" class="numbered-list" start="3"><li>서버의 응답 차단<ul id="182e8cfa-c68c-80e3-9729-d83523ca6956" class="bulleted-list"><li style="list-style-type:disc">서버보다 위조 패킷을 먼저 보낼 시 정상 패킷은 SEQ, ACK 번호가 맞지 않아 비정상적인 데이터로 처리, 드롭함</li></ul></li></ol></details></li></ul></li></ol></li></ol><ul id="182e8cfa-c68c-80d7-abcc-ce644e06d738" class="bulleted-list"><li style="list-style-type:circle">공격시 제한 사항<ul id="182e8cfa-c68c-806d-b5b9-ddc03e3b804a" class="bulleted-list"><li style="list-style-type:square"><code>CLOSE</code> 상태 타임 아웃 상태에서 새로운 연결 발생<ul id="182e8cfa-c68c-8007-85e2-f89417561211" class="bulleted-list"><li style="list-style-type:disc">NAT 매핑이 CLOSE 상태에 있을 때 클라이언트와 서버 간의 트래픽이 발생하면 타임아웃이 초기화되며, 이는 공격과정을 꼬아 버림</li></ul></li></ul><ul id="182e8cfa-c68c-8093-b2fe-c9c48bd95c78" class="bulleted-list"><li style="list-style-type:square">AP 격리 활성화<ul id="182e8cfa-c68c-8044-9297-e2f7dc34c24d" class="bulleted-list"><li style="list-style-type:disc">위 경우 공격자는 클라이언트로의 통신이 차단되어 NAT 매핑 복원이 어려워지며 이는 TCP 인젝션 공격에 제한을 줌</li></ul></li></ul></li></ul></li></ul></li></ol><p id="182e8cfa-c68c-80ff-950d-ff4bc7b965cd" class="">
</p><h1 id="182e8cfa-c68c-807f-9757-f6f26cd081cc" class="">실험 결과</h1><figure id="182e8cfa-c68c-802b-931e-c615de418013" class="image"><a href="image%202.png"><img style="width:707.96875px" src="image%202.png"/></a></figure><ul id="182e8cfa-c68c-80a0-abaa-c62ca1682edd" class="bulleted-list"><li style="list-style-type:disc">대부분의 라우터 운영체제는 <strong>수정된 Linux 기반</strong>이였으며 일부 TP-Link 및 Mercury 라우터는 <strong>VxWorks 기반</strong>이었음</li></ul><ul id="182e8cfa-c68c-80d0-a7a8-cb3db90372fe" class="bulleted-list"><li style="list-style-type:disc"> FreeBSD 기반 펌웨어인 <strong>pfSense 2.7.0</strong>을 사용하여 소프트 라우팅 환경 구축하였음</li></ul><ul id="182e8cfa-c68c-8064-869e-cf8bfb741984" class="bulleted-list"><li style="list-style-type:disc">총 30개 벤더에서 67개의 주요 라우터 모델을 테스트</li></ul><ul id="182e8cfa-c68c-804a-827c-d4bcb0586011" class="bulleted-list"><li style="list-style-type:disc"><strong>테스트 조건</strong><ol type="1" id="182e8cfa-c68c-8091-b937-e40f02aef803" class="numbered-list" start="1"><li><strong>라우터는 포트 유지 전략을 사용해야함</strong><ul id="182e8cfa-c68c-8063-b69f-d51d5e7c3104" class="bulleted-list"><li style="list-style-type:disc">대부분의 라우터가 해당 전략 사용함</li></ul><ul id="182e8cfa-c68c-80f0-9c9a-e1dff1668cc4" class="bulleted-list"><li style="list-style-type:disc">pfSense 소프트웨어 사용한 모델은 포트 유지 대신 랜덤 선택 사용하였음</li></ul><ul id="182e8cfa-c68c-80a2-b364-d4e64669fc9e" class="bulleted-list"><li style="list-style-type:disc">순차 선택이나 포트 오버로딩 전략은 전무하였음</li></ul></li></ol><ol type="1" id="182e8cfa-c68c-8053-89d7-c11fa810223a" class="numbered-list" start="2"><li><strong>역방향 경로 검증 전략 비활성화</strong><ul id="182e8cfa-c68c-80fd-bafc-cc1b32721093" class="bulleted-list"><li style="list-style-type:disc">Netgear와 Asus 라우터는 <strong>rp_filter 커널 변수</strong>를 기본적으로 1로 설정하여 엄격한 패킷 검증을 수행하며, 이는 공격을 방지하였음</li></ul><ul id="182e8cfa-c68c-8047-a3a2-c1b0c53ed09f" class="bulleted-list"><li style="list-style-type:disc">TP-Link와 Mercury의 일부 구형 모델(VxWorks 기반)도 패킷을 검증함</li></ul><ul id="182e8cfa-c68c-8035-944e-ecf8420317d7" class="bulleted-list"><li style="list-style-type:disc"><strong>최신 모델(Wi-Fi 6 지원)과 일부 기업용 라우터는 해당 전략 비활성화 돼있었음</strong><p id="182e8cfa-c68c-801c-8c5a-caef07b7e812" class="">ex) ZTE 라우터, Huawei &quot;AR6140E-9G-2AC&quot;, pfSense 기반 소프트 라우터</p></li></ul><ul id="182e8cfa-c68c-8095-abb7-c4c425f115cf" class="bulleted-list"><li style="list-style-type:disc">위 외의 벤더 라우터는 해당 전략 비활성화 되어 있었음</li></ul></li></ol><ol type="1" id="182e8cfa-c68c-806b-8d69-e135521fd454" class="numbered-list" start="3"><li><strong>TCP 윈도우 추적 전략 비활성화</strong><ul id="182e8cfa-c68c-8000-a01a-e2b4f50974cc" class="bulleted-list"><li style="list-style-type:disc">Cisco Meraki의 기업용 유선 라우터 모델 **&quot;Meraki 64&quot;**만이 시퀀스 번호를 엄격히 검증</li></ul><ul id="182e8cfa-c68c-8078-be01-f77b8daf4200" class="bulleted-list"><li style="list-style-type:disc">그 외의 라우터는 해당 전략 비활성화 함<ul id="182e8cfa-c68c-8014-ba72-e47e5110b979" class="bulleted-list"><li style="list-style-type:circle">처리 방식에 차이가 있긴함(2GB 밴더 확인 or 확인 X)</li></ul></li></ul></li></ol><ol type="1" id="182e8cfa-c68c-80c4-bc5a-d8be7ad0424e" class="numbered-list" start="4"><li><strong>TCP의 </strong><code><strong>CLOSE</strong></code><strong> 상태의 NAT 매핑 타임아웃 시간</strong><ul id="182e8cfa-c68c-8031-b6d6-e83bf6672c60" class="bulleted-list"><li style="list-style-type:disc">타임 아웃이 짧을 수록 공격 가능성이 높아짐</li></ul><ul id="182e8cfa-c68c-80a3-89f6-f79c75845107" class="bulleted-list"><li style="list-style-type:disc">pfSense를 제외하고 10초 이내에 삭제되는 설정이였음(10s: 56%, 1s: 42%)</li></ul></li></ol><p id="182e8cfa-c68c-800c-8737-c5523e91da25" class="">⇒ 결론적으로 77%의 모델이 공격에 취약하였음</p></li></ul><ul id="182e8cfa-c68c-80ac-8e2c-d4fcd95711d1" class="toggle"><li><details open=""><summary><strong>공격 환경 설정</strong></summary><ul id="182e8cfa-c68c-8021-b920-d3c23da44837" class="bulleted-list"><li style="list-style-type:disc">라우터<ul id="182e8cfa-c68c-80a3-98b8-fc53bfcce983" class="bulleted-list"><li style="list-style-type:circle">Wi-Fi 네트워크에서 로컬 클라이언트와 외부 서버 간의 인터넷 액세스를 제공하고 패킷을 전달하는 게이트웨이 역할을 수행</li></ul></li></ul><ul id="182e8cfa-c68c-8031-983a-f639b9279c7a" class="bulleted-list"><li style="list-style-type:disc">원격 서버<ul id="182e8cfa-c68c-8094-beee-c031ca87fadc" class="bulleted-list"><li style="list-style-type:circle"><strong>DoS 공격</strong>: Ubuntu 22.04(커널 버전 5.15.0), OpenSSH 8.9, OpenSSL 3.0.2로 구성된 SSH 서버.</li></ul><ul id="182e8cfa-c68c-8019-893c-cc9ef0c8f4ad" class="bulleted-list"><li style="list-style-type:circle"><strong>하이재킹 공격</strong>: Ubuntu 22.04(커널 버전 5.15.0)과 vsftpd 3.0.3으로 구성된 FTP 서버.</li></ul><ul id="182e8cfa-c68c-80ac-946b-cbe9f8ea854d" class="bulleted-list"><li style="list-style-type:circle"><strong>인젝션 공격</strong>: 클라이언트가 1분마다 장기간 TCP 연결을 통해 데이터 업데이트를 주기적으로 수집하는 잘 알려진 금융 웹사이트</li></ul></li></ul><ul id="182e8cfa-c68c-80f7-9473-e80de7bff7c2" class="bulleted-list"><li style="list-style-type:disc">Victim client<ul id="182e8cfa-c68c-80a9-87be-c64849b3bad3" class="bulleted-list"><li style="list-style-type:circle">운영 체제(OS) 유형이나 버전에 제한 없이, Windows, Linux, Mac, iOS, Android를 포함한 5개의 전형적인 OS를 사용해 설정.</li></ul><ul id="182e8cfa-c68c-80ec-8fe8-ee261d49db37" class="bulleted-list"><li style="list-style-type:circle">DoS 및 하이재킹 공격에서 SSH 및 FTP를 통해 서버와 통신.</li></ul><ul id="182e8cfa-c68c-8059-b745-dc965a3acae0" class="bulleted-list"><li style="list-style-type:circle">인젝션 공격에서 위 웹사이트에 접속하여 최신 주식 지수(HIS, HSCEI)를 조회.</li></ul></li></ul><ul id="182e8cfa-c68c-803b-85b1-ec84a8b01a3f" class="bulleted-list"><li style="list-style-type:disc">공격자<ul id="182e8cfa-c68c-8060-83bb-e8149d125589" class="bulleted-list"><li style="list-style-type:circle">패킷 조작이 가능한 Linux 5.15.0으로 구성된 공격 머신.</li></ul><ul id="182e8cfa-c68c-800f-a93d-eda166ce979a" class="bulleted-list"><li style="list-style-type:circle">피해자의 SSH 연결을 종료하거나 FTP 서버에서 개인 파일을 탈취하거나 클라이언트로 위조된 HTTP 응답을 주입하는 것이 목표.</li></ul></li></ul></details></li></ul><ul id="182e8cfa-c68c-80eb-9f52-cbe794765c65" class="bulleted-list"><li style="list-style-type:disc"><a href="25%2001%2021%20TCP%20Hijacking%20in%20NAT-Enabled%20Wi-Fi%20Networ%2017fe8cfac68c80f0a8e8eb7efcff4f57.html">공격 절차</a></li></ul><ul id="182e8cfa-c68c-80c0-ad01-c8627d7b2f33" class="bulleted-list"><li style="list-style-type:disc">공격 성공 조건<ul id="182e8cfa-c68c-805d-a1f2-c715c6036dc5" class="bulleted-list"><li style="list-style-type:circle">SSH DoS 공격<ul id="182e8cfa-c68c-80cc-a9e5-dee9aa0ac975" class="bulleted-list"><li style="list-style-type:square">클라이언트와 서버가 서로 메시지를 주고받을 수 없게 되면 공격이 성공</li></ul></li></ul><ul id="182e8cfa-c68c-807f-88fc-d12a01f6a823" class="bulleted-list"><li style="list-style-type:circle">FTP 하이재킹 공격<ul id="182e8cfa-c68c-8038-a124-e637bba35532" class="bulleted-list"><li style="list-style-type:square">공격자가 피해자 클라이언트의 개인 파일을 FTP 서버에서 다운로드하면 성공</li></ul></li></ul><ul id="182e8cfa-c68c-800f-a62d-c35398e3dfe9" class="bulleted-list"><li style="list-style-type:circle">HTTP 인젝션 공격<ul id="182e8cfa-c68c-80d0-bd34-c53113adf34a" class="bulleted-list"><li style="list-style-type:square">클라이언트가 위조된 패킷을 수신하고, 웹 페이지에 위조된 데이터가 표시되면 성공</li></ul></li></ul></li></ul><ul id="182e8cfa-c68c-809d-aab3-e82b7d990266" class="bulleted-list"><li style="list-style-type:disc">공격 결과<figure id="182e8cfa-c68c-8072-b1d0-e104dc66528c" class="image"><a href="image%203.png"><img style="width:528px" src="image%203.png"/></a></figure><ul id="182e8cfa-c68c-801f-876e-fc9936ca1be2" class="bulleted-list"><li style="list-style-type:circle">93개의 실세계 Wi-Fi 네트워크를 대상으로 공격 진행</li></ul><ul id="182e8cfa-c68c-80ac-b1dd-c3766cc0add4" class="bulleted-list"><li style="list-style-type:circle"><strong><span style="border-bottom:0.05em solid">81%의 네트워크(75개)가 공격에 완전 취약</span></strong>, 공격 조건을 충족하였음</li></ul><ul id="182e8cfa-c68c-80e2-add5-fa4d7d9e08db" class="bulleted-list"><li style="list-style-type:circle">그 외의 18개의 네트워크 실패 원인 분석<ul id="182e8cfa-c68c-80d9-ac5f-e9cb2f996b31" class="bulleted-list"><li style="list-style-type:square">9개: AP 격리 활성화됨 ⇒ HTTP 인젝션 방어됨, But DoS와 하이재킹에 여전히 취약</li></ul><ul id="182e8cfa-c68c-802f-86ab-c4b631121534" class="bulleted-list"><li style="list-style-type:square">7개: 취약한 라우터가 아니라 공격 실패</li></ul><ul id="182e8cfa-c68c-8086-911b-ed30d8a1c78e" class="bulleted-list"><li style="list-style-type:square">2개: 라우터의 외부 IP 취득에 실패 </li></ul></li></ul></li></ul><h1 id="17fe8cfa-c68c-80d4-a249-ee1e84b28c82" class="">nA영상 QnA 분석</h1><ol type="1" id="17fe8cfa-c68c-803f-9301-ce14803e6211" class="numbered-list" start="1"><li><strong>질문</strong>: 취약하지 않은 라우터의 주요 특징은 무엇인가요?<p id="17fe8cfa-c68c-80d6-871d-d75e8b6ec5cb" class="">⇒ 취약하지 않은 라우터는 대개 랜덤 포트 할당 방식이나 역방향 경로 검증(reverse path validation)을 활성화해 공격을 방어합니다. TCP 윈도우 추적을 활성화한 경우도 방어 가능성이 높습니다.</p></li></ol><ol type="1" id="17fe8cfa-c68c-80a6-896f-c1778f2e81be" class="numbered-list" start="2"><li><strong>질문: </strong>암호화는 공격에 어떤 영향을 미칠까요? 예를 들어, HTTPS가 적용되면 공격자가 데이터 삽입 공격을 수행할 수 없는지요?<p id="17fe8cfa-c68c-807f-ab4f-efe4f92e7692" class="">⇒ 암호화는 공격 결과에 영향을 줄 수 있습니다. 예를 들어, HTTPS가 적용되면 공격자는 연결에 데이터를 주입할 수 없습니다. 트래픽이 암호화되기 때문입니다. 하지만 현재 시점에서, 약 20%의 웹사이트가 여전히 암호화되지 않은 상태로 평문 데이터를 전송하고 있습니다. 또한, 트래픽이 암호화되더라도 공격자는 연결을 재설정 패킷을 보내 연결을 끊는 방법으로도 영향을 미칠 수 있습니다.</p></li></ol><ol type="1" id="17fe8cfa-c68c-801f-9852-ec64de4fb4d1" class="numbered-list" start="3"><li><strong>질문</strong>: WPA2, WPA3 암호화는 공격에 영향을 미치나요?</li></ol><p id="17fe8cfa-c68c-8002-9647-f72ff0baffae" class="">⇒ 암호화는 트래픽 보호에 영향을 주지만, 이 공격은 IP 및 전송 계층(TCP)에서 발생하기 때문에 링크 계층(Wi-Fi 암호화) 보호만으로는 방어할 수 없습니다. 공격자가 Wi-Fi 비밀번호를 알고 있고, 네트워크에 접속할 수 있는 경우 공격이 가능합니다.</p><ol type="1" id="17fe8cfa-c68c-801b-b734-f569fdc27a93" class="numbered-list" start="4"><li><strong>질문</strong>: 어플리케이션 계층에서 HTTPS가 없어도, 공격자가 Wi-Fi 패킷을 라우터로 보내려 할 경우, 인증되지 않거나 허가되지 않은 클라이언트에서 보낸 패킷은 라우터에서 거부되지 않나요? 즉, HTTPS와 상관없이 이런 패킷은 차단될 텐데요?<p id="17fe8cfa-c68c-8021-b29c-efa04b2c667c" class="">⇒ Wi-Fi 네트워크에서는 링크 계층에서 트래픽이 암호화되지만, 이 공격은 IP 계층 및 전송 계층에서 발생합니다. 따라서 링크 계층 암호화는 공격에 영향을 미치지 않습니다.<br/><br/><br/></p></li></ol><p id="17fe8cfa-c68c-801f-acc0-ce4bcc4d8f50" class="">
</p></div></article><span class="sans" style="font-size:14px;padding-top:2em"></span></body></html>